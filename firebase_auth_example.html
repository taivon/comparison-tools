<!DOCTYPE html>
<html>
<head>
    <title>Firebase Auth Test</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
</head>
<body>
    <div id="auth-container">
        <button id="google-signin">Sign in with Google</button>
        <button id="signout" style="display:none;">Sign Out</button>
        <div id="user-info"></div>
    </div>

    <script>
        // Your Firebase config (you'd need to get this from Firebase Console)
        const firebaseConfig = {
            // Add your config here
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        
        const auth = firebase.auth();
        const provider = new firebase.auth.GoogleAuthProvider();
        
        // Google Sign In
        document.getElementById('google-signin').addEventListener('click', () => {
            auth.signInWithPopup(provider)
                .then((result) => {
                    const user = result.user;
                    console.log('User signed in:', user);
                    
                    // Send user data to Django backend to sync with Firestore
                    syncUserWithDjango(user);
                })
                .catch((error) => {
                    console.error('Error during sign in:', error);
                });
        });
        
        // Sign Out
        document.getElementById('signout').addEventListener('click', () => {
            auth.signOut();
        });
        
        // Auth state observer
        auth.onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('google-signin').style.display = 'none';
                document.getElementById('signout').style.display = 'block';
                document.getElementById('user-info').innerHTML = `
                    <h3>Welcome ${user.displayName}</h3>
                    <p>Email: ${user.email}</p>
                `;
            } else {
                document.getElementById('google-signin').style.display = 'block';
                document.getElementById('signout').style.display = 'none';
                document.getElementById('user-info').innerHTML = '';
            }
        });
        
        // Sync user with Django backend
        function syncUserWithDjango(user) {
            fetch('/api/sync-firebase-user/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({
                    uid: user.uid,
                    email: user.email,
                    displayName: user.displayName,
                    photoURL: user.photoURL
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('User synced with Django:', data);
            });
        }
        
        // Get CSRF token
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</body>
</html>